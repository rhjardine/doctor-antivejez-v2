<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profesionales - MediLongevity</title> <!-- Title updated -->

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <!-- Updated version -->

  <!-- Google Fonts (Using Inter from main dashboard) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Librería SheetJS (xlsx) - Kept -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

  <!-- Chart.js Adapters (If needed by dashboard JS, include them) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Added Chart.js base -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0"></script>


  <!-- === CSS FROM dashboard_advanced_gen.html (Including Base and New Sidebar Styles) === -->
  <style>
    :root {
        /* Using variables from dashboard_advanced_gen */
        --primary-color: #62B6CB; /* Sky Blueish */
        --primary-dark: #3D8DAE;  /* Darker Blue */
        --primary-light: #8ECAE6; /* Lighter Blue */
        --secondary-color: #13293D; /* Dark Blue/Grey */
        --secondary-light: #247BA0;
        --text-dark: #2C3E50;
        --text-medium: #546E7A;
        --text-light: #78909C;
        --bg-light: #F8F9FA;
        --bg-white: #FFFFFF;
        --bg-card: #EEF1F5; /* Light Grey Card BG */
        --danger: #E63946; /* Red */
        --warning: #F9A826; /* Yellow/Orange */
        --success: #2DC653; /* Green */
        --info: #5BC0EB;   /* Light Blue Info */
        --border-color: #D9E2EC; /* Light Grey Border */

        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

        --radius-sm: 0.25rem;
        --radius-md: 0.375rem;
        --radius-lg: 0.5rem;
        --radius-xl: 0.75rem;

        --transition: all 0.3s ease;

        /* Add RGB versions for transparency */
        --primary-rgb: 98, 182, 203;
        --danger-rgb: 230, 57, 70;
        --warning-rgb: 249, 168, 38;
        --success-rgb: 45, 198, 83;
        --info-rgb: 91, 192, 235;
        --secondary-rgb: 19, 41, 61;
    }

    .dark-mode {
        /* Dark mode variables from dashboard */
        --primary-color: #62B6CB;
        --primary-dark: #3D8DAE;
        --primary-light: #8ECAE6;
        --text-dark: #E0E6ED;
        --text-medium: #B8C4CF;
        --text-light: #8D99A4;
        --bg-light: #1A2634;  /* Dark BG */
        --bg-white: #242F3F;  /* Darker Element BG */
        --bg-card: #2E3A4A;   /* Card BG */
        --border-color: #3A4858; /* Dark Border */

        /* RGB Dark mode */
        --primary-rgb: 98, 182, 203;
        --danger-rgb: 230, 57, 70;
        --warning-rgb: 249, 168, 38;
        --success-rgb: 45, 198, 83;
        --info-rgb: 91, 192, 235;
        --secondary-rgb: 19, 41, 61;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', sans-serif; /* Use Inter font */
        color: var(--text-dark);
        background-color: var(--bg-light);
        line-height: 1.5;
        transition: var(--transition);
         /* Remove old padding */
    }

    /* Styles specific to the app layout from dashboard */
    .app-container {
        display: flex;
        min-height: 100vh;
    }

    /* === Sidebar Styles from dashboard_advanced_gen.html === */
    .sidebar {
        width: 220px;
        background: linear-gradient(to bottom, var(--bg-white) 70%, color-mix(in srgb, var(--bg-white) 90%, var(--text-light) 10%));
        border-right: 1px solid var(--border-color);
        padding: 1.5rem 0;
        display: flex;
        flex-direction: column;
        transition: var(--transition);
        height: 100vh; /* Make sidebar full height */
        position: fixed; /* Fixed sidebar */
        left: 0;
        top: 0;
        z-index: 100; /* Ensure sidebar is on top */
    }

    .sidebar.collapsed {
        width: 64px;
    }
     /* Adjust main content padding based on sidebar state */
    .main-content {
        flex: 1;
        padding: 1.5rem;
        overflow-y: auto;
        margin-left: 220px; /* Initial margin for expanded sidebar */
        transition: margin-left 0.3s ease;
        background-color: var(--bg-light);
        min-height: 100vh; /* Ensure content area fills height */
    }

    .sidebar.collapsed + .main-content {
        margin-left: 64px; /* Margin for collapsed sidebar */
    }


    .sidebar-header {
        padding: 0 1.5rem 1.5rem;
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        /* justify-content: space-between; */ /* Center logo when collapsed */
        justify-content: center; /* Center logo always for now */
        align-items: center;
        height: 60px; /* Match header height */
    }

    .logo {
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        text-decoration: none; /* Remove underline from link */
    }

    /* Styling for the logo image */
    .logo-img {
        height: 35px; /* Adjust height as needed */
        width: auto;
        max-height: 40px;
        display: block;
        object-fit: contain; /* Ensure aspect ratio is maintained */
    }
    .sidebar.collapsed .logo-img {
         height: 30px; /* Slightly smaller when collapsed */
     }


    .logo i { /* Keep DNA icon style if needed elsewhere */
        font-size: 1.5rem;
        transition: var(--transition);
        color: var(--primary-color); /* Ensure icon color matches */
    }

    .logo:hover i {
        transform: rotate(360deg);
    }
    /* Hide text span when collapsed */
    .sidebar.collapsed .logo span {
        display: none;
    }


    .nav-menu {
        flex: 1;
        list-style-type: none;
        margin-top: 1rem; /* Add some space below header */
    }

    .nav-item {
        padding: 0;
        display: flex;
        align-items: center;
        color: var(--text-medium);
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
    }

    .nav-item a {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        color: inherit;
        text-decoration: none;
        width: 100%;
        height: 100%;
        border-left: 3px solid transparent;
        transition: var(--transition);
        box-sizing: border-box;
    }

    .nav-item a:hover {
        color: var(--primary-color);
        background-color: rgba(var(--primary-rgb), 0.1); /* Use RGB var */
        transform: translateX(3px);
    }

    .nav-item.active a {
        color: var(--primary-color);
        background-color: rgba(var(--primary-rgb), 0.15); /* Slightly darker active */
        border-left-color: var(--primary-color);
        font-weight: 600; /* Bold active item */
    }

    .nav-item i {
        font-size: 1.25rem;
        width: 1.25rem;
        text-align: center;
        flex-shrink: 0; /* Prevent icon shrinking */
    }

    .sidebar.collapsed .logo span,
    .sidebar.collapsed .nav-item span,
    .sidebar.collapsed .user-info {
        display: none;
    }

    .sidebar.collapsed .nav-item a {
        justify-content: center;
        padding: 0.75rem;
    }
    .sidebar.collapsed .nav-item {
        padding: 0;
    }

    .user-profile {
        padding: 1rem 1.5rem;
        margin-top: auto;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        border-top: 1px solid var(--border-color);
        transition: var(--transition);
    }

    .user-profile:hover {
        background-color: rgba(var(--primary-rgb), 0.05);
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1rem;
        transition: var(--transition);
        flex-shrink: 0;
    }

    .user-profile:hover .user-avatar {
        transform: scale(1.05);
    }

    .user-info {
        flex: 1;
        overflow: hidden;
    }

    .user-name {
        font-weight: 600;
        color: var(--text-dark);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .user-role {
        color: var(--text-light);
        font-size: 0.813rem;
    }

    .sidebar.collapsed .user-profile {
        justify-content: center;
        padding: 1rem;
    }
     /* === End Sidebar Styles === */


    /* === Styles specific to profesionales.html content START === */
    /* (Using variables from the new :root) */

    .profesionales-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color); /* Use var */
        flex-wrap: wrap;
        gap: 15px;
    }
    .profesionales-header h2 {
        margin: 0;
        color: var(--text-dark); /* Use theme text color */
        font-weight: 600;
        font-size: 1.6rem;
    }
    .profesionales-toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
        padding: 1rem;
        background-color: var(--bg-white); /* Add background */
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-sm);
    }
    .buscar-profesionales {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-grow: 1;
        min-width: 250px;
    }
    #filtro-nombre {
        padding: 8px 12px;
        border: 1px solid var(--border-color); /* Use var */
        border-radius: var(--radius-sm); /* Use var */
        font-size: 14px;
        flex-grow: 1;
        background-color: var(--bg-white);
        color: var(--text-dark);
    }
     #filtro-nombre::placeholder {
         color: var(--text-light);
     }

    /* General Button Styles */
    .btn {
        padding: 8px 15px; /* Slightly more padding */
        border: none;
        border-radius: var(--radius-md); /* Use var */
        cursor: pointer;
        font-size: 0.9rem;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
        text-decoration: none;
        white-space: nowrap;
        line-height: 1.5; /* Ensure text aligns well */
    }
    .btn:active { transform: scale(0.98); }

    /* Specific Button Colors (using theme variables) */
    .btn-primary { background-color: var(--primary-color); color: white; }
    .btn-primary:hover { background-color: var(--primary-dark); box-shadow: var(--shadow-sm); }

    .btn-secondary { background-color: var(--text-medium); color: white; } /* Greyish */
    .btn-secondary:hover { background-color: var(--text-dark); }

    .btn-excel { background-color: var(--success); color: white; } /* Green */
    .btn-excel:hover { background-color: color-mix(in srgb, var(--success) 85%, black 15%); }

    .btn-info { background-color: var(--info); color: white; } /* Light blue */
    .btn-info:hover { background-color: color-mix(in srgb, var(--info) 85%, black 15%); }

    .btn-danger { background-color: var(--danger); color: white; } /* Red */
    .btn-danger:hover { background-color: color-mix(in srgb, var(--danger) 85%, black 15%); }

    /* Smaller buttons for table actions */
    .profesionales-table .btn { padding: 5px 8px; font-size: 0.8rem; }

     /* Form Limit Styles */
    .form-limit-warning { color: var(--warning); font-weight: bold; }
    .form-limit-reached { color: var(--danger); font-weight: bold; }
    .form-limit-icon { margin-left: 5px; }

    /* Table Styles */
    .table-responsive {
        overflow-x: auto;
        background: var(--bg-white); /* Use var */
        padding: 20px;
        border-radius: var(--radius-lg); /* Use var */
        box-shadow: var(--shadow-md); /* Use var */
    }
     .table-responsive h3 {
         margin-top: 0;
         margin-bottom: 1rem;
         font-size: 1.2rem;
         color: var(--text-dark);
     }
    table.profesionales-table { width: 100%; border-collapse: collapse; }
    .profesionales-table th, .profesionales-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color); /* Use var */
        white-space: nowrap;
        vertical-align: middle; /* Align vertically */
    }
    .profesionales-table th {
        background-color: var(--bg-card); /* Use var */
        color: var(--text-dark); /* Use var */
        font-weight: 600;
        font-size: 0.85rem; /* Slightly smaller */
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .profesionales-table tbody tr:hover {
        background-color: var(--bg-light); /* Use var */
    }
    /* Status text color */
    .profesionales-table td.status-active { color: var(--success); font-weight: 500; }
    .profesionales-table td.status-inactive { color: var(--text-light); }


    /* Modal Styles */
    .modal {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
        z-index: 1050; /* Ensure modal is above sidebar */
        overflow-y: auto; padding: 5vh 20px;
        align-items: center; /* Center vertically */
        justify-content: center; /* Center horizontally */
        display: none; /* Hide initially, controlled by JS */
        opacity: 0; /* Start invisible */
        transition: opacity 0.3s ease;
    }
     .modal.show { /* Class added by JS to show */
         display: flex;
         opacity: 1;
     }
    .modal-content {
        background-color: var(--bg-white); /* Use var */
        margin: auto; /* Keep centering */
        padding: 30px;
        border-radius: var(--radius-lg); /* Use var */
        box-shadow: var(--shadow-lg); /* Use var */
        width: 95%;
        max-width: 600px;
        position: relative;
        transform: translateY(-20px); /* Start slightly up */
        transition: transform 0.3s ease;
    }
     .modal.show .modal-content {
         transform: translateY(0); /* Slide in */
     }
    .close-button {
        position: absolute; top: 10px; right: 15px; font-size: 28px;
        font-weight: bold; cursor: pointer; color: var(--text-light); /* Use var */
        line-height: 1; background: none; border: none; padding: 0;
    }
    .close-button:hover { color: var(--danger); /* Use var */ }
    .modal-content h3 {
        margin-top: 0; margin-bottom: 25px;
        color: var(--text-dark); /* Use var */
        font-size: 1.4rem;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
    }
    /* Form Group styles inside modal */
    .modal .form-group { margin-bottom: 15px; }
    .modal .form-group label {
        display: block; margin-bottom: 8px; font-weight: 600;
        font-size: 0.9rem; color: var(--text-dark); /* Use var */
    }
    .modal .form-group input[type="text"],
    .modal .form-group input[type="email"],
    .modal .form-group input[type="number"],
    .modal .form-group select {
        width: 100%; padding: 10px; border: 1px solid var(--border-color); /* Use var */
        border-radius: var(--radius-sm); /* Use var */ box-sizing: border-box;
        font-size: 1rem; background-color: var(--bg-white); color: var(--text-dark);
    }
    .modal .form-group input:focus,
    .modal .form-group select:focus {
        border-color: var(--primary-color); /* Use var */
        outline: none; box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2); /* Use var */
    }
    .modal .form-group select:required:invalid { color: var(--text-light); /* Use var */ }
    .modal .form-group option:not(:disabled) { color: var(--text-dark); background-color: var(--bg-white); } /* Ensure options are readable */
    .modal .form-group input[type="number"]:disabled{
        background-color: var(--bg-light); /* Use var */
        cursor: not-allowed; opacity: 0.7;
    }
    .modal-content .form-buttons {
        margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px;
        padding-top: 20px; border-top: 1px solid var(--border-color);
    }


    /* Paginación Styles */
    .pagination { display: flex; list-style: none; padding: 0; justify-content: center; margin-top: 20px; }
    .pagination li { margin: 0 4px; /* Reduced margin */ }
    .pagination a {
        display: block; padding: 6px 12px; /* Adjusted padding */ border: 1px solid var(--border-color); /* Use var */
        text-decoration: none; color: var(--text-medium); /* Use var */
        background-color: var(--bg-white); /* Use var */
        border-radius: var(--radius-sm); /* Use var */ transition: var(--transition);
    }
    .pagination a:hover { background-color: var(--bg-light); /* Use var */ border-color: var(--text-light); }
    .pagination li.active a {
        background-color: var(--primary-color); /* Use var */
        color: white; border-color: var(--primary-color); /* Use var */
        font-weight: 500;
    }
    .pagination li.disabled a {
        color: var(--text-light); /* Use var */
        cursor: default; background-color: var(--bg-card); /* Use var */
        border-color: var(--border-color); /* Use var */ opacity: 0.6;
    }


    /* Cards Resumen Styles */
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .card {
        background: var(--bg-white); /* Use var */
        padding: 20px; border-radius: var(--radius-lg); /* Use var */
        box-shadow: var(--shadow-md); /* Use var */
        text-align: center;
    }
     .card h3 {
         margin-top: 0;
         margin-bottom: 0.5rem;
         font-size: 1rem;
         color: var(--text-medium);
         font-weight: 500;
     }
     .card p {
         font-size: 2rem;
         font-weight: 600;
         margin: 0;
     }
     /* Specific card text colors */
     #total-profesionales { color: var(--primary-color); }
     #profesionales-activos { color: var(--success); }
     #profesionales-inactivos { color: var(--danger); }


    /* === Dark Mode Styles for Profesionales Content === */
    body.dark-mode .profesionales-header { border-bottom-color: var(--border-color); }
    body.dark-mode .profesionales-header h2 { color: var(--text-dark); }
    body.dark-mode .profesionales-toolbar { background-color: var(--bg-card); box-shadow: var(--shadow-sm); }
    body.dark-mode #filtro-nombre { background-color: var(--bg-white); border-color: var(--border-color); color: var(--text-dark); }
     body.dark-mode #filtro-nombre::placeholder { color: var(--text-light); }
    body.dark-mode .table-responsive, body.dark-mode .card { background: var(--bg-card); color: var(--text-dark); box-shadow: var(--shadow-md); } /* Adjusted shadow */
    body.dark-mode .table-responsive h3 { color: var(--text-dark); }
    body.dark-mode .profesionales-table th { background-color: var(--bg-white); color: var(--text-dark); }
    body.dark-mode .profesionales-table td { border-bottom-color: var(--border-color); }
    body.dark-mode .profesionales-table tbody tr:hover { background-color: var(--bg-white); }
    body.dark-mode .profesionales-table td.status-active { color: var(--success); }
    body.dark-mode .profesionales-table td.status-inactive { color: var(--text-light); }

    body.dark-mode .form-limit-warning { color: var(--warning); }
    body.dark-mode .form-limit-reached { color: var(--danger); }

    body.dark-mode .modal-content { background-color: var(--bg-card); color: var(--text-dark); }
    body.dark-mode .modal-content h3 { color: var(--text-dark); border-bottom-color: var(--border-color); }
    body.dark-mode .close-button { color: var(--text-light); }
    body.dark-mode .close-button:hover { color: var(--danger); }
    body.dark-mode .modal .form-group label { color: var(--text-dark); }
    body.dark-mode .modal .form-group input, body.dark-mode .modal .form-group select {
        background-color: var(--bg-white); border: 1px solid var(--border-color); color: var(--text-dark);
    }
    body.dark-mode .modal .form-group input::placeholder { color: var(--text-light); }
    body.dark-mode .modal .form-group select:required:invalid { color: var(--text-light); }
     body.dark-mode .modal .form-group option:not(:disabled) { color: var(--text-dark); background-color: var(--bg-white); }
    body.dark-mode .modal .form-group input[type="number"]:disabled { background-color: var(--bg-light); opacity: 0.6; }
     body.dark-mode .modal-content .form-buttons { border-top-color: var(--border-color); }


    body.dark-mode .pagination a { color: var(--text-light); background-color: var(--bg-card); border-color:var(--border-color); }
    body.dark-mode .pagination a:hover { background-color: var(--bg-white); border-color: var(--text-medium); }
    body.dark-mode .pagination li.active a { background-color: var(--primary-color); color: var(--bg-white); border-color: var(--primary-color); }
    body.dark-mode .pagination li.disabled a { color: var(--text-light); background-color: var(--bg-card); border-color: var(--border-color); opacity: 0.5; }

    /* === Styles specific to profesionales.html content END === */

    /* Theme Toggle Button Style (from dashboard) */
    .theme-toggle {
        position: fixed; bottom: 1.5rem; right: 1.5rem; width: 3rem; height: 3rem;
        border-radius: 50%; background-color: var(--primary-color); color: white;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        box-shadow: var(--shadow-lg); z-index: 999; transition: var(--transition);
    }
    .theme-toggle:hover { transform: scale(1.05); background-color: var(--primary-dark); }

    /* Toast Container Styles (from dashboard) */
    .toast-container {
        position: fixed; top: 1.5rem; right: 1.5rem; z-index: 9999;
        display: flex; flex-direction: column; gap: 0.75rem;
    }
    .toast {
        padding: 0.75rem 1rem; background-color: var(--bg-white);
        border-radius: var(--radius-md); box-shadow: var(--shadow-lg);
        display: flex; align-items: center; gap: 0.75rem;
        transform: translateX(120%); transition: transform 0.3s ease; max-width: 350px;
        border-left: 4px solid var(--info); /* Default border */
    }
     .toast.success { border-left-color: var(--success); }
     .toast.warning { border-left-color: var(--warning); }
     .toast.error { border-left-color: var(--danger); }
     .toast.info { border-left-color: var(--info); }

    .toast.show { transform: translateX(0); }
    .toast-icon { font-size: 1.25rem; }
    .toast-icon.success { color: var(--success); }
    .toast-icon.warning { color: var(--warning); }
    .toast-icon.error { color: var(--danger); }
    .toast-icon.info { color: var(--info); }
    .toast-content { flex: 1; }
    .toast-title { font-weight: 600; color: var(--text-dark); font-size: 0.875rem; margin-bottom: 0.25rem; }
    .toast-message { color: var(--text-medium); font-size: 0.813rem; }
    .toast-close { background: none; border: none; font-size: 1rem; color: var(--text-light); cursor: pointer; transition: var(--transition); padding: 0.2rem;}
    .toast-close:hover { color: var(--danger); transform: scale(1.1); }


    /* Responsive Adjustments (Merging dashboard and profesionales MQ) */
    @media (max-width: 1024px) {
        .main-content { margin-left: 64px; padding: 1rem; } /* Adjust margin and padding */
        .sidebar:not(.collapsed) + .main-content { margin-left: 220px; } /* Restore margin if expanded */
    }

    @media (max-width: 768px) {
        /* Sidebar already handled in base styles */
         .main-content { margin-left: 64px; } /* Keep collapsed margin */
         .sidebar.expanded + .main-content { margin-left: 220px; } /* Restore margin if expanded */

         .profesionales-header { flex-direction: column; align-items: flex-start; }
         .profesionales-toolbar { flex-direction: column; align-items: stretch; }
         .buscar-profesionales { width: 100%; }
         .profesionales-toolbar > div:last-child { align-self: flex-end; } /* Align export button right */
    }

    @media (max-width: 480px) {
        .app-container { flex-direction: column; }
        .sidebar {
            width: 100%; height: auto; padding: 1rem 0; position: static; /* Static on mobile */
            border-right: none; border-bottom: 1px solid var(--border-color);
        }
        .sidebar.collapsed { width: 100%; } /* Full width always */
        .main-content { margin-left: 0; padding: 0.75rem; } /* No margin on mobile */
        .sidebar-header { height: auto; padding-bottom: 1rem;} /* Adjust header */
        .nav-menu { flex-direction: row; flex-wrap: wrap; justify-content: center; } /* Horizontal menu */
        .nav-item { flex-basis: auto; min-width: 60px; }
        .nav-item a { padding: 0.5rem; flex-direction: column; align-items: center; font-size: 0.75rem; gap: 0.25rem; border-left: none; border-bottom: 3px solid transparent; }
        .nav-item.active a { border-left-color: transparent; border-bottom-color: var(--primary-color); }
        .nav-item a:hover { transform: none; }
        .nav-item a span { display: block; font-size: 0.75rem; }
        .sidebar.collapsed .nav-item a { padding: 0.5rem; }
        .user-profile { display: none; }
        .modal-content { width: 95%; padding: 20px; }
        .modal-content h3 { font-size: 1.2rem; }
        .form-buttons { flex-direction: column; gap: 10px; }
        .form-buttons button { width: 100%; }
        .theme-toggle { bottom: 1rem; right: 1rem; width: 2.5rem; height: 2.5rem;} /* Adjust theme toggle */
    }

  </style>
</head>

<body>
  <!-- === New App Container Structure === -->
  <div class="app-container">

    <!-- === New Sidebar HTML (with logo replaced) === -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <!-- Logo Replaced -->
            <a href="dashboard_advanced_gen.html" class="logo" id="toggle-sidebar"> <!-- Make logo clickable link -->
                <img src="assets/logo.png" alt="Logo Doctor Antivejez" class="logo-img">
                <!-- Span is removed as requested -->
            </a>
            <!-- Toggle button for smaller screens (controlled by JS/CSS) -->
             <button class="sidebar-toggle-btn" aria-label="Toggle Sidebar" style="display:none; background:none; border:none; color:var(--primary-color); font-size:1.5rem; cursor:pointer; padding:0.5rem;">
                 <i class="fas fa-bars"></i>
             </button>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard_advanced_gen.html">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="historias_tabs_bio.html">
                    <i class="fas fa-book-medical"></i>
                    <span>Historias</span>
                </a>
            </li>
             <li class="nav-item active"> <!-- Set 'Profesionales' as active -->
                <a href="profesionales.html">
                    <i class="fas fa-user-md"></i>
                    <span>Profesionales</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#"> <!-- Placeholder -->
                    <i class="fas fa-robot"></i>
                    <span>Agente IA</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#"> <!-- Placeholder -->
                    <i class="fas fa-file-medical-alt"></i>
                    <span>Reportes</span>
                </a>
            </li>
            <li class="nav-item">
                 <a href="#"> <!-- Placeholder -->
                    <i class="fas fa-cog"></i>
                    <span>Ajustes</span>
                </a>
            </li>
             <li class="nav-item">
                 <a href="#"> <!-- Placeholder -->
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Salir</span>
                </a>
            </li>
        </ul>

        <div class="user-profile">
            <div class="user-avatar">
                <i class="fas fa-user-md"></i> <!-- Or relevant icon -->
            </div>
            <div class="user-info">
                <div class="user-name">Dr. García</div> <!-- Example user -->
                <div class="user-role">Especialista</div>
            </div>
        </div>
    </div> <!-- End New Sidebar -->


    <!-- === Original Main Content from profesionales.html === -->
    <div class="main-content">

        <!-- Cabecera -->
        <div class="profesionales-header">
            <h2>Gestión de Profesionales</h2>
            <button class="btn btn-primary" onclick="abrirModalAgregar()"> <i class="fas fa-plus"></i> Agregar Profesional </button>
        </div>

        <!-- Barra de herramientas -->
        <div class="profesionales-toolbar">
            <div class="buscar-profesionales">
            <input type="text" id="filtro-nombre" placeholder="Buscar por nombre, apellido o cédula..." onkeyup="filtrarProfesionales()">
            <button class="btn btn-secondary" onclick="limpiarFiltro()"><i class="fas fa-times"></i> Limpiar</button>
            </div>
            <div> <button class="btn btn-excel" onclick="exportarExcel()"><i class="fas fa-file-excel"></i> Exportar</button> </div>
        </div>

        <!-- Tabla -->
        <div class="table-responsive">
            <h3>Listado de Profesionales</h3>
            <table class="profesionales-table">
                <thead>
                <tr>
                    <th>Nombre y Apellido</th>
                    <th>Cédula</th>
                    <th>Correo</th>
                    <th>Rol</th>
                    <th>Estatus</th>
                    <th>Formularios</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody id="tabla-profesionales">
                    <!-- Content generated by JS -->
                </tbody>
            </table>
            <ul class="pagination">
                 <!-- Content generated by JS -->
            </ul>
        </div>

        <!-- Cards Resumen -->
        <div class="cards" style="margin-top: 2rem;">
            <div class="card"> <h3>Total Profesionales</h3> <p id="total-profesionales">--</p> </div>
            <div class="card"> <h3>Activos</h3> <p id="profesionales-activos">--</p> </div>
            <div class="card"> <h3>Inactivos</h3> <p id="profesionales-inactivos">--</p> </div>
        </div>

    </div> <!-- Fin .main-content -->

    <!-- Modal (Remains outside main-content for fixed positioning) -->
    <div id="modal-profesional" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="cerrarModal()" aria-label="Cerrar">×</button>
            <h3 id="modal-titulo">Añadir Profesional</h3>
            <form id="form-profesional" onsubmit="guardarProfesional(event)">
                <div class="form-group"> <label for="nombre">Nombre:</label> <input type="text" id="nombre" name="nombre" required> </div>
                <div class="form-group"> <label for="apellido">Apellido:</label> <input type="text" id="apellido" name="apellido" required> </div>
                <div class="form-group"> <label for="cedula">Cédula:</label> <input type="text" id="cedula" name="cedula" required> </div>
                <div class="form-group"> <label for="correo">Correo:</label> <input type="email" id="correo" name="correo" required> </div>
                <div class="form-group"> <label for="rol">Rol:</label> <select id="rol" name="rol" required> <option value="" disabled selected>Seleccione un Rol</option> <option value="Medico">Medico</option> <option value="Odontólogo">Odontólogo</option> <option value="Coach">Coach</option> <option value="Administrativo">Administrativo</option> </select> </div>
                <div class="form-group"> <label for="estatus">Estatus:</label> <select id="estatus" name="estatus"> <option value="0">Inactivo</option> <option value="1" selected>Activo</option> </select> </div>
                <div class="form-group"> <label for="formularios">Formularios Usados:</label> <input type="number" id="formularios" name="formularios" value="0" readonly style="background-color: var(--bg-light);"> </div> <!-- Readonly and styled -->
                <input type="hidden" id="id-profesional" name="id">
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal()"><i class="fas fa-times"></i> Cancelar</button>
                </div>
            </form>
        </div>
    </div>

     <!-- Toast Container (from dashboard) -->
     <div class="toast-container" id="toast-container"></div>
     <!-- Theme Toggle (from dashboard) -->
     <div class="theme-toggle" id="theme-toggle">
         <i class="fas fa-moon"></i>
     </div>

  </div> <!-- Fin .app-container -->


  <script>
    // === Combined Scripts ===

    // --- Logic Specific to Profesionales START ---
    let profesionales = []; // Main data store
    let profesionalEditandoId = null; // ID of the professional being edited
    let paginaActual = 1; // Current table page
    const itemsPorPagina = 5; // Items per page
    const FORM_LIMIT = 10; // Form usage limit
    const LIMITED_ROLES = ['Medico', 'Odontólogo', 'Coach']; // Roles subject to limit
    const FORM_LIMIT_WARNING_THRESHOLD = 8; // Warning threshold

    async function cargarProfesionales() {
        console.log("Cargando profesionales (simulación)...");
        // SIMULATION - Replace with actual API call
        await new Promise(resolve => setTimeout(resolve, 200)); // Simulate delay
        profesionales = [
             { id: 1, nombre: "Richard", apellido: "Jarbine", cedula: "V-12345653", correo: "mjardineig@gmail.com", rol: "Medico", estatus: "0", formularios: 0, notificationSent: false },
             { id: 2, nombre: "Carolina", apellido: "Salvatori", cedula: "E-23522935", correo: "DRACAROLINASALVATORI@hotmail.com", rol: "Medico", estatus: "1", formularios: 50, notificationSent: true }, // Limit surpassed
             { id: 3, nombre: "Silvina", apellido: "Plaza", cedula: "E-27388831", correo: "SILVINA_PLAZA@HOTMAIL.COM", rol: "Odontólogo", estatus: "1", formularios: 9, notificationSent: false }, // Near limit
             { id: 4, nombre: "Claudia", apellido: "Tocomas", cedula: "E-26837632", correo: "DRA_CLAUDIA_TOCOMAS@HOTMAIL.COM", rol: "Coach", estatus: "1", formularios: 10, notificationSent: false }, // At limit
             { id: 5, nombre: "Lidia", apellido: "Alonzo", cedula: "E-22754862", correo: "LIDIAESTERALONZO@GMAIL.COM", rol: "Administrativo", estatus: "1", formularios: 50, notificationSent: false }, // Not limited role
             { id: 6, nombre: "Juan", apellido: "Perez", cedula: "V-9876543", correo: "jperez@mail.com", rol: "Coach", estatus: "1", formularios: 7, notificationSent: false },
             { id: 7, nombre: "Maria", apellido: "Gonzalez", cedula: "V-1122334", correo: "mgonzalez@mail.com", rol: "Medico", estatus: "0", formularios: 11, notificationSent: false }, // Limit surpassed, inactive
        ];
        actualizarCardsResumen();
        // Apply filter immediately after loading
        filtrarProfesionales(); // This will call mostrarPagina(1)
        console.log("Profesionales cargados y tabla renderizada.");
    }


    function renderizarTabla(profesionalesPagina) {
        const tablaBody = document.getElementById('tabla-profesionales');
        if (!tablaBody) return;
        tablaBody.innerHTML = '';

        if (profesionalesPagina.length === 0) {
            tablaBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: var(--text-light);">No se encontraron profesionales.</td></tr>';
            return;
        }

        profesionalesPagina.forEach(profesional => {
            const fila = tablaBody.insertRow();
            const isLimitedRole = LIMITED_ROLES.includes(profesional.rol);
            let formStatusClass = '';
            let formIconHTML = '';
            let needsNotification = false;
            const formCount = parseInt(profesional.formularios) || 0; // Ensure number

            if (isLimitedRole) {
                if (formCount >= FORM_LIMIT) {
                    formStatusClass = 'form-limit-reached';
                    formIconHTML = `<i class="fas fa-exclamation-triangle form-limit-icon" title="Límite (${FORM_LIMIT}) alcanzado - Requiere renovación"></i>`;
                    if (!profesional.notificationSent) {
                        needsNotification = true;
                    }
                } else if (formCount >= FORM_LIMIT_WARNING_THRESHOLD) {
                    formStatusClass = 'form-limit-warning';
                    formIconHTML = `<i class="fas fa-exclamation-circle form-limit-icon" title="Cerca del límite (${FORM_LIMIT}) de formularios"></i>`;
                }
                 if (formCount < FORM_LIMIT && profesional.notificationSent) {
                    profesional.notificationSent = false; // Reset flag if below limit (for testing mainly)
                 }
            }

            // Use theme variables for status color
            const statusClass = profesional.estatus === '1' ? 'status-active' : 'status-inactive';
            const statusText = profesional.estatus === '1' ? 'Activo' : 'Inactivo';

            fila.innerHTML = `
                <td>${profesional.nombre || ''} ${profesional.apellido || ''}</td>
                <td>${profesional.cedula || ''}</td>
                <td>${profesional.correo || ''}</td>
                <td>${profesional.rol || 'No asignado'}</td>
                <td class="${statusClass}">
                    ${statusText}
                </td>
                <td class="${formStatusClass}">
                    ${formCount} ${formIconHTML}
                </td>
                <td>
                    <button class="btn btn-info btn-sm" onclick="verDetalle(${profesional.id})" title="Ver Detalles"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-primary btn-sm" onclick="editarProfesional(${profesional.id})" title="Editar"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-danger btn-sm" onclick="eliminarProfesional(${profesional.id})" title="Eliminar"><i class="fas fa-trash-alt"></i></button>
                </td>
            `;

            if (needsNotification) {
                simularEnvioNotificacion(profesional);
                profesional.notificationSent = true; // Mark as sent IN MEMORY for this session
            }
        });
    }

     function simularEnvioNotificacion(profesional) {
        console.warn(`%c¡SIMULACIÓN! Notificación de renovación requerida para ${profesional.nombre} ${profesional.apellido} (ID: ${profesional.id}, Rol: ${profesional.rol}). Ha alcanzado ${profesional.formularios} formularios.`, "color: orange; font-weight: bold;");
        // Optionally show a toast notification
        showToast('Límite Alcanzado', `${profesional.nombre} requiere renovación (límite: ${FORM_LIMIT} formularios).`, 'warning');
         // Real implementation: Backend handles actual email/SMS notification
     }

    function abrirModalAgregar() {
        profesionalEditandoId = null;
        const modal = document.getElementById('modal-profesional');
        const form = document.getElementById('form-profesional');
        const titulo = document.getElementById('modal-titulo');
        const submitButton = form.querySelector('button[type="submit"]');

        if (!modal || !form || !titulo || !submitButton) return;

        titulo.textContent = 'Añadir Profesional';
        form.reset(); // Reset form fields

        // Ensure fields are enabled and formulrios is readonly
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => { input.disabled = false; });
        const formInput = document.getElementById('formularios');
        if(formInput) {
            formInput.readOnly = true; // Make readonly instead of disabled for styling consistency
            formInput.style.backgroundColor = 'var(--bg-light)'; // Style as readonly
             formInput.value = 0; // Default to 0 for new user
        }


        submitButton.style.display = 'inline-flex'; // Show save button
        modal.classList.add('show'); // Use class to show modal
        document.getElementById('nombre')?.focus(); // Focus first field
    }

    function cerrarModal() {
        const modal = document.getElementById('modal-profesional');
        if (modal) modal.classList.remove('show');
    }

    function guardarProfesional(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const profesionalData = Object.fromEntries(formData.entries());

        // Basic Validation
        if (!profesionalData.nombre || !profesionalData.apellido || !profesionalData.cedula || !profesionalData.correo || !profesionalData.rol) {
             showToast('Error', 'Por favor, completa todos los campos obligatorios (Nombre, Apellido, Cédula, Correo, Rol).', 'error');
             return;
         }

        if (profesionalEditandoId !== null) { // Editing existing
            const index = profesionales.findIndex(p => p.id === profesionalEditandoId);
            if (index !== -1) {
                // Preserve existing form count and notification status when editing
                profesionales[index] = {
                    ...profesionales[index], // Keep existing values like formularios, notificationSent
                    ...profesionalData,     // Apply updated form data
                    id: profesionalEditandoId // Ensure ID remains the same
                };
                 showToast('Éxito', 'Profesional actualizado correctamente.', 'success');
            } else {
                 showToast('Error', 'No se encontró el profesional para editar.', 'error');
                 return; // Exit if index not found
             }
        } else { // Adding new
            const nuevoId = profesionales.length > 0 ? Math.max(...profesionales.map(p => p.id)) + 1 : 1;
            // Add new professional with default form count and notification status
            profesionales.push({
                ...profesionalData,
                id: nuevoId,
                formularios: 0, // Start new professionals with 0 forms
                notificationSent: false
            });
             showToast('Éxito', 'Profesional agregado correctamente.', 'success');
        }

        profesionalEditandoId = null; // Reset editing ID
        actualizarCardsResumen();
        filtrarProfesionales(); // Refresh table with current filter and page
        cerrarModal();
        console.log("Profesional guardado/actualizado.");
    }


    function verDetalle(id) {
        const profesional = profesionales.find(p => p.id === id);
        if (!profesional) return;
        const modal = document.getElementById('modal-profesional');
        const form = document.getElementById('form-profesional');
        const titulo = document.getElementById('modal-titulo');
        const submitButton = form.querySelector('button[type="submit"]');

        if (!modal || !form || !titulo || !submitButton) return;

        // Populate form
        for (const key in profesional) {
            const field = form.elements[key];
            if (field) {
                field.value = profesional[key];
            }
        }
        // Special handling for hidden ID if needed
        const idField = form.elements['id'];
        if (idField) idField.value = profesional.id;

        titulo.textContent = 'Ver Detalles Profesional';

        // Disable all fields
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => { input.disabled = true; });

        submitButton.style.display = 'none'; // Hide save button
        modal.classList.add('show'); // Show modal
    }

    function editarProfesional(id) {
        const profesional = profesionales.find(p => p.id === id);
        if (!profesional) return;
        const modal = document.getElementById('modal-profesional');
        const form = document.getElementById('form-profesional');
        const titulo = document.getElementById('modal-titulo');
        const submitButton = form.querySelector('button[type="submit"]');

        if (!modal || !form || !titulo || !submitButton) return;

        profesionalEditandoId = id; // Set editing ID

        // Populate form
        for (const key in profesional) {
            const field = form.elements[key];
            if (field) {
                field.value = profesional[key];
            }
        }
        const idField = form.elements['id'];
        if (idField) idField.value = profesional.id;


        titulo.textContent = 'Editar Profesional';

        // Enable fields, keep 'formularios' readonly
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => { input.disabled = false; });
        const formInput = document.getElementById('formularios');
         if(formInput) {
             formInput.readOnly = true;
             formInput.style.backgroundColor = 'var(--bg-light)';
         }

        submitButton.style.display = 'inline-flex'; // Show save button
        modal.classList.add('show'); // Show modal
        document.getElementById('nombre')?.focus(); // Focus first field
    }

    function eliminarProfesional(id) {
        const profesional = profesionales.find(p => p.id === id);
        if (!profesional) return;

        if (confirm(`¿Estás seguro de que quieres eliminar a ${profesional.nombre} ${profesional.apellido}?`)) {
            profesionales = profesionales.filter(p => p.id !== id);

            // Adjust current page if the last item on the last page was deleted
             const filtro = document.getElementById('filtro-nombre')?.value.toLowerCase() || '';
             const profFiltrados = profesionales.filter(p => `${p.nombre} ${p.apellido} ${p.cedula}`.toLowerCase().includes(filtro));
             const totalPaginas = Math.ceil(profFiltrados.length / itemsPorPagina);

             if (paginaActual > totalPaginas && totalPaginas > 0) {
                 paginaActual = totalPaginas;
             } else if (totalPaginas === 0) {
                 paginaActual = 1; // Reset to page 1 if no results left
             }

            actualizarCardsResumen();
            mostrarPagina(paginaActual); // Render the possibly adjusted current page
            showToast('Eliminado', `Profesional ${profesional.nombre} eliminado.`, 'success');
            console.log(`Profesional con ID ${id} eliminado.`);
        }
    }

    function filtrarProfesionales() {
        paginaActual = 1; // Reset to first page on filter change
        mostrarPagina(paginaActual);
    }

    function limpiarFiltro() {
        const filtroInput = document.getElementById('filtro-nombre');
        if (filtroInput) filtroInput.value = '';
        paginaActual = 1;
        mostrarPagina(paginaActual);
    }

    function exportarExcel() {
        const filtro = document.getElementById('filtro-nombre')?.value.toLowerCase() || '';
        const dataToExport = profesionales
            .filter(p => `${p.nombre} ${p.apellido} ${p.cedula}`.toLowerCase().includes(filtro))
            .map(p => ({
                Nombre: p.nombre,
                Apellido: p.apellido,
                Cedula: p.cedula,
                Correo: p.correo,
                Rol: p.rol,
                Estatus: p.estatus === "1" ? 'Activo' : 'Inactivo',
                Formularios: p.formularios
            }));

        if (dataToExport.length === 0) {
            showToast("Exportar", "No hay datos para exportar según el filtro actual.", 'info');
            return;
        }

        try {
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Profesionales");
            XLSX.writeFile(wb, "profesionales_medilongevity.xlsx"); // Updated filename
            showToast("Exportar", "Datos exportados a Excel.", 'success');
        } catch (error) {
             console.error("Error al exportar a Excel:", error);
             showToast("Error Exportación", "No se pudo generar el archivo Excel.", 'error');
         }
    }

    function renderizarPaginacion() {
        const filtro = document.getElementById('filtro-nombre')?.value.toLowerCase() || '';
        const profesionalesFiltrados = profesionales.filter(p => `${p.nombre} ${p.apellido} ${p.cedula}`.toLowerCase().includes(filtro));
        const totalItems = profesionalesFiltrados.length;
        const totalPaginas = Math.ceil(totalItems / itemsPorPagina);
        const paginacionUl = document.querySelector('.pagination');

        if (!paginacionUl) return;
        paginacionUl.innerHTML = ''; // Clear previous pagination

        if (totalPaginas <= 1) return; // No pagination needed for 0 or 1 page

        // Previous Button
        paginacionUl.appendChild(crearBotonPaginacion('«', paginaActual - 1, paginaActual === 1));

        // Page Numbers (simplified for brevity, consider ellipsis for many pages)
        for (let i = 1; i <= totalPaginas; i++) {
             // Basic implementation: show all pages. Refine if needed.
             paginacionUl.appendChild(crearBotonPaginacion(i, i, false, i === paginaActual));
        }

        // Next Button
        paginacionUl.appendChild(crearBotonPaginacion('»', paginaActual + 1, paginaActual === totalPaginas));
    }

     function crearBotonPaginacion(texto, numPagina, deshabilitado = false, activo = false) {
         const li = document.createElement('li');
         const a = document.createElement('a');
         a.href = '#';
         a.innerHTML = texto; // Use innerHTML to allow entities like « »
         a.setAttribute('aria-label', `Página ${texto}`);

         if (deshabilitado) {
             li.classList.add('disabled');
             a.setAttribute('aria-disabled', 'true');
         } else {
             a.onclick = (e) => { e.preventDefault(); cambiarPagina(numPagina); };
         }
         if (activo) {
             li.classList.add('active');
             a.setAttribute('aria-current', 'page');
         }
         li.appendChild(a);
         return li;
     }


    function cambiarPagina(numPagina) {
         const filtro = document.getElementById('filtro-nombre')?.value.toLowerCase() || '';
         const profesionalesFiltrados = profesionales.filter(p => `${p.nombre} ${p.apellido} ${p.cedula}`.toLowerCase().includes(filtro));
         const totalPaginas = Math.ceil(profesionalesFiltrados.length / itemsPorPagina);

         if (numPagina < 1 || numPagina > totalPaginas) return; // Boundary check

         paginaActual = numPagina;
         mostrarPagina(paginaActual);
         window.scrollTo(0, 0); // Scroll to top on page change
    }

    function mostrarPagina(numPagina) {
        const filtro = document.getElementById('filtro-nombre')?.value.toLowerCase() || '';
        const profesionalesFiltrados = profesionales.filter(p => `${p.nombre} ${p.apellido} ${p.cedula}`.toLowerCase().includes(filtro));
        const inicio = (numPagina - 1) * itemsPorPagina;
        const fin = inicio + itemsPorPagina;
        const profesionalesPagina = profesionalesFiltrados.slice(inicio, fin);

        renderizarTabla(profesionalesPagina);
        renderizarPaginacion(); // Update pagination based on current page
    }


    function actualizarCardsResumen() {
        const total = profesionales.length;
        const activos = profesionales.filter(p => p.estatus === "1").length;
        const inactivos = total - activos;

        const totalEl = document.getElementById('total-profesionales');
        const activosEl = document.getElementById('profesionales-activos');
        const inactivosEl = document.getElementById('profesionales-inactivos');

        if(totalEl) totalEl.textContent = total;
        if(activosEl) activosEl.textContent = activos;
        if(inactivosEl) inactivosEl.textContent = inactivos;
    }

    // --- Profesionales Logic END ---


    // --- Dashboard General Logic START ---
     // Theme Toggle Logic (from dashboard, ensure it's defined once)
     const themeToggleBtn = document.getElementById('theme-toggle');
     if (themeToggleBtn) {
         // Set initial state based on system preference or saved state
         const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
         const savedTheme = localStorage.getItem('theme');

         if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
             document.body.classList.add('dark-mode');
             themeToggleBtn.querySelector('i')?.classList.replace('fa-moon', 'fa-sun');
         } else {
             document.body.classList.remove('dark-mode');
             themeToggleBtn.querySelector('i')?.classList.replace('fa-sun', 'fa-moon');
         }

         // Add click listener
         themeToggleBtn.addEventListener('click', () => {
             document.body.classList.toggle('dark-mode');
             const isDarkMode = document.body.classList.contains('dark-mode');
             const icon = themeToggleBtn.querySelector('i');
             if (icon) {
                 icon.classList.toggle('fa-sun', isDarkMode);
                 icon.classList.toggle('fa-moon', !isDarkMode);
             }
             localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
         });
     }

     // Sidebar Toggle Logic (from dashboard)
     const sidebarEl = document.getElementById('sidebar'); // Use the new ID
     const mainContentEl = document.querySelector('.main-content');
     // Use the logo itself as the toggle trigger for consistency
     const sidebarToggleTrigger = document.getElementById('toggle-sidebar');

     if (sidebarEl && sidebarToggleTrigger && mainContentEl) {
         sidebarToggleTrigger.addEventListener('click', (e) => {
             e.preventDefault(); // Prevent link navigation if logo is a link
             sidebarEl.classList.toggle('collapsed');
             // Adjust main content margin based on sidebar state
              if (sidebarEl.classList.contains('collapsed')) {
                  mainContentEl.style.marginLeft = '64px';
              } else {
                  mainContentEl.style.marginLeft = '220px';
              }
         });

         // Add button toggle for smaller screens if sidebar-toggle-btn exists
          const mobileToggleButton = document.querySelector('.sidebar-toggle-btn');
          if (mobileToggleButton) {
             mobileToggleButton.addEventListener('click', () => {
                 sidebarEl.classList.toggle('expanded-mobile'); // Use a different class for mobile expansion overlay if needed
                 // Or reuse 'collapsed' if the mobile CSS handles it
                 sidebarEl.classList.toggle('collapsed');
                 // No margin adjustment needed typically for mobile overlay/static modes
             });
          }

         // Ensure correct initial margin on load based on sidebar state
          if (sidebarEl.classList.contains('collapsed')) {
               mainContentEl.style.marginLeft = '64px';
           } else {
               mainContentEl.style.marginLeft = '220px';
           }


     } else {
         console.warn("Sidebar, main content, or toggle trigger not found. Sidebar toggle disabled.");
     }


    // showToast Function (ensure defined once globally)
    function showToast(title, message, type = 'info') { // Default to info
        const toastContainer = document.getElementById('toast-container');
        if(!toastContainer) {
            console.warn('Toast container not found!');
            return;
        }

        const toast = document.createElement('div');
        toast.className = `toast ${type}`; // Add type class for border/icon
        const iconClass = type === 'success' ? 'fas fa-check-circle' :
                          type === 'warning' ? 'fas fa-exclamation-triangle' :
                          type === 'error'   ? 'fas fa-times-circle' :
                                               'fas fa-info-circle'; // Default info
        toast.innerHTML = `
            <div class="toast-icon ${type}"><i class="${iconClass}"></i></div>
            <div class="toast-content">
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close"><i class="fas fa-times"></i></button>
        `;
        toastContainer.appendChild(toast);

        const closeButton = toast.querySelector('.toast-close');
        closeButton?.addEventListener('click', () => {
            toast.classList.remove('show');
            setTimeout(() => { if (toast.parentNode) toast.remove(); }, 300);
        });

        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 10);

        // Auto-dismiss
        setTimeout(() => {
            if (toast.parentNode === toastContainer) {
                toast.classList.remove('show');
                setTimeout(() => {
                     if (toast.parentNode === toastContainer) toast.remove();
                 }, 300);
            }
        }, 5000);
    }


    // --- Dashboard General Logic END ---


    // Initialize everything after DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        cargarProfesionales(); // Load professionals data and render initial view

        // Add listener for modal closing with Escape key
         window.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                 const modal = document.getElementById('modal-profesional');
                 if (modal && modal.classList.contains('show')) {
                     cerrarModal();
                 }
             }
         });

         // Add listener for closing modal by clicking background
         const modal = document.getElementById('modal-profesional');
         if (modal) {
             modal.addEventListener('click', function (event) {
                 if (event.target === modal) { // Check if click is on the backdrop itself
                     cerrarModal();
                 }
             });
         }

        console.log("Profesionales page fully initialized.");
    });

  </script>
</body>
</html>